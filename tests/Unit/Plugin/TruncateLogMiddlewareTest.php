<?php

namespace Freshcells\SoapClientBundle\Tests\Unit\Plugin;

use Freshcells\SoapClientBundle\Plugin\TruncateLogMiddleware;
use PHPUnit\Framework\TestCase;

class TruncateLogMiddlewareTest extends TestCase
{
    public function testTruncate()
    {
        $middleware = new TruncateLogMiddleware(100);
        $res        = $middleware->apply($this->getXml());
        $this->assertTrue(strlen($res) === 100);
    }

    protected function getXML() {
        return '<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><OTA_HotelDescriptiveInfoRS EchoToken="042b75c2-922d-11eb-87c1-0242ac1f0005" PrimaryLangID="en-gb" TimeStamp="2021-03-31T14:29:45+00:00" xmlns="http://www.opentravel.org/OTA/2003/05"><Success/><HotelDescriptiveContents><HotelDescriptiveContent ChainName="Jaz Hotel Group" HotelCodeContext="CRS" HotelName="Iberotel Luxor" HotelCode="61584" ChainCode="16401" CurrencyCode="USD" LanguageCode="en-GB" TimeZone="+02" UnitOfMeasureCode="2" Overwrite="true"><Policies><Policy><CancelPolicy><CancelPenalty PolicyCode="03D"><PenaltyDescription><Text>In case of Cancellation within 03 days prior to arrival or No Show, 01 night charge apply.</Text></PenaltyDescription><Deadline OffsetTimeUnit="Day" OffsetUnitMultiplier="3" OffsetDropTime="BeforeArrival"/></CancelPenalty></CancelPolicy><PaymentPolicy><RequiredPayment PaymentCode="CCG"><Deadline OffsetTimeUnit="Day" OffsetUnitMultiplier="0"/><PaymentDescription><Text>All Reservations will be guaranteed by a valid credit card.&#xD; â—€
Hotel reserves right to pre-authorize the credit card. &#xD;
Please note that as per Egyptian Law, all foreign guests must pay in foreign currency.</Text></PaymentDescription><AcceptedPayments><AcceptedPayment><PaymentCard CardCode="DN"/></AcceptedPayment><AcceptedPayment><PaymentCard CardCode="VI"/></AcceptedPayment><AcceptedPayment><PaymentCard CardCode="MC"/></AcceptedPayment><AcceptedPayment><PaymentCard CardCode="AX"/></AcceptedPayment></AcceptedPayments></RequiredPayment></PaymentPolicy><PolicyInfo CheckInTime="1400" CheckOutTime="1200" KidsStayFree="true" MaxChildAge="11"/><GuaranteePaymentPolicy><GuaranteePayment Type="Guarantee Policy"><Description><Text>For the Hotel Guarantee Policy - See Rate Rules</Text></Description></GuaranteePayment><GuaranteePayment Type="Deposit Policy"><Description><Text>A Deposit may be required - See Rate Rules</Text></Description></GuaranteePayment></GuaranteePaymentPolicy><PetsPolicies><PetsPolicy><Description><Text>The property does not allowed any pets</Text></Description></PetsPolicy></PetsPolicies><PolicyInfoCodes><PolicyInfoCode><Description Name="Early Checkout"><Text>Early check-out is free - please contact hotel front desk for late check out policy</Text></Description></PolicyInfoCode><PolicyInfoCode><Description Name="Late Checkout"><Text>Contact hotel front office for the information about  late checkout</Text></Description></PolicyInfoCode><PolicyInfoCode><Description Name="Family Policy"><Text>Property suitable for chd / One Chd up to 12 stay free  in same room as a paying adult using existing bedding / Chd over 12 year age -  charge as an adult / 1st chld - 00-11.99 year - free acoomodation  / 2nd Child 06-11.99  charged 50 pct from 1/2 twin room rate</Text></Description></PolicyInfoCode><PolicyInfoCode><Description Name="Group Policy"><Text>When booking more than 5 rooms additional supplements may apply. Bookings will be non-refundable and full amount of the stay will be charged anytime. Please contact the hotel for more information about groups</Text></Description></PolicyInfoCode></PolicyInfoCodes><CommissionPolicy><Description><Text>The Rates are commissionable by 10 percent for travel agency. Exceptions may apply - please see Hotel Policy.</Text></Description></CommissionPolicy></Policy></Policies><AffiliationInfo><Awards><Award Provider="AA Star" Rating="4 Stars"/><Award Provider="Local Star Rating" Rating="4 Stars"/></Awards></AffiliationInfo><ContactInfos><ContactInfo><Names><Name/></Names><Addresses><Address FormattedInd="false" DefaultInd="false"><AddressLine>Khaled Ibn El Walid Street</AddressLine><AddressLine>P.O.Box 28</AddressLine><AddressLine>Gazirat Al Awameyah</AddressLine><CityName>Luxor</CityName><PostalCode>84511</PostalCode><CountryName Code="EG">Egypt</CountryName></Address></Addresses><Phones><Phone PhoneTechType="Voice" PhoneNumber="*****"/><Phone PhoneTechType="Voice" PhoneNumber="*****"/><Phone PhoneTechType="Fax" PhoneNumber="*****"/></Phones><Emails>*****</Email></Emails><URLs><URL>http://www.jaz.travel/destinations/egypt/luxor-hotels/iberot</URL></URLs></ContactInfo></ContactInfos></HotelDescriptiveContent></HotelDescriptiveContents></OTA_HotelDescriptiveInfoRS></s:Body></s:Envelope> ';
    }
}
